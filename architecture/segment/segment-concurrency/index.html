
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
        <meta name="author" content="Jan Jirout">
      
      
        <link rel="canonical" href="https://jajir.github.io/HestiaStore/architecture/segment/segment-concurrency/">
      
      
        <link rel="prev" href="../arch-index/">
      
      
        <link rel="next" href="../../registry/">
      
      
        
      
      
      <link rel="icon" href="../../../images/favicon.ico">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>Segment Concurrency - HestiaStore</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#concurrency-lifecycle" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="HestiaStore" class="md-header__button md-logo" aria-label="HestiaStore" data-md-component="logo">
      
  <img src="../../../images/logo-square.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            HestiaStore
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Segment Concurrency
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9zM20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zm-9.15 3.96h2.3L12 9z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to system preference"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to system preference" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/jajir/HestiaStore" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    jajir/HestiaStore
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../.." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../why-hestiastore/" class="md-tabs__link">
          
  
  
    
  
  Why HestiaStore

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../how-to-use/" class="md-tabs__link">
          
  
  
    
  
  Getting Started

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../configuration/" class="md-tabs__link">
          
  
  
    
  
  Configuration

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../" class="md-tabs__link">
          
  
  
    
  
  Architecture

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../CHANGELOG/" class="md-tabs__link">
          
  
  
    
  
  Community

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="HestiaStore" class="md-nav__button md-logo" aria-label="HestiaStore" data-md-component="logo">
      
  <img src="../../../images/logo-square.png" alt="logo">

    </a>
    HestiaStore
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/jajir/HestiaStore" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    jajir/HestiaStore
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../why-hestiastore/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Why HestiaStore
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2" id="__nav_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Why HestiaStore
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../why-hestiastore/alternatives/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Alternatives
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_3" >
        
          
          <label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Benchmarks
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Benchmarks
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../why-hestiastore/out-write/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Write test
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../why-hestiastore/out-read/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Read test
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../why-hestiastore/out-sequential/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Sequential read test
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../SECURITY/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Security
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../why-hestiastore/quality/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Quality & Testing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../how-to-use/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Getting Started
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3" id="__nav_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Getting Started
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../how-to-use/install/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Install
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../how-to-use/quick-start/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Quick Start
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../how-to-use/troubleshooting/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Troubleshooting
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://javadoc.io/doc/org.hestiastore.index/core" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    API Reference
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../configuration/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Configuration
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4" id="__nav_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Configuration
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../configuration/data-types/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Data Types
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../configuration/logging/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Logging
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Architecture
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5" id="__nav_5_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Architecture
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../general/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    General
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_2" id="__nav_5_2_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    General
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../general/datablock/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Data Block Format
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../general/filters/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Filters & Integrity
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../general/chain-of-filters/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chain of Filters
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../general/concurrency/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Access Model
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../general/recovery/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Consistency & Recovery
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../general/limits/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Limitations & Trade-offs
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../general/glossary/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Glossary
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_3" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../segmentindex/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    SegmentIndex
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_3" id="__nav_5_3_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    SegmentIndex
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../segmentindex/write-path/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Write Path
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../segmentindex/read-path/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Read Path
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../segmentindex/caching/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Caching Strategy
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../segmentindex/cache-lru/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Cache LRU
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../segmentindex/performance/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Performance Model & Sizing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../segmentindex/segment-index-concurrency/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Segment Index Concurrency
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_4" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Segment
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_4" id="__nav_5_4_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Segment
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../segment/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Segment Design
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../on-disk-layout/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    On-Disk Layout & File Names
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../arch-index/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Sparse Index
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Segment Concurrency
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Segment Concurrency
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#glossary" class="md-nav__link">
    <span class="md-ellipsis">
      
        Glossary
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#segment-operations" class="md-nav__link">
    <span class="md-ellipsis">
      
        Segment operations
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Segment operations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#response-codes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Response Codes
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#iterator-modes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Iterator Modes
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#segment-states" class="md-nav__link">
    <span class="md-ellipsis">
      
        Segment States
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Segment States">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#transitions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Transitions
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#optimistic-locking" class="md-nav__link">
    <span class="md-ellipsis">
      
        Optimistic locking
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Optimistic locking">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#iterator-isolation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Iterator Isolation
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#segment-behavior" class="md-nav__link">
    <span class="md-ellipsis">
      
        Segment Behavior
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Segment Behavior">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#operation-behavior-matrix" class="md-nav__link">
    <span class="md-ellipsis">
      
        Operation Behavior Matrix
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flushcompact-lifecycle" class="md-nav__link">
    <span class="md-ellipsis">
      
        Flush/Compact Lifecycle
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#failure-cancellation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Failure &amp; Cancellation
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#concepts" class="md-nav__link">
    <span class="md-ellipsis">
      
        Concepts
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Concepts">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#core-rules" class="md-nav__link">
    <span class="md-ellipsis">
      
        Core Rules
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#contracts-and-guarantees" class="md-nav__link">
    <span class="md-ellipsis">
      
        Contracts and Guarantees
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Contracts and Guarantees">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#atomic-publish-invariant" class="md-nav__link">
    <span class="md-ellipsis">
      
        Atomic Publish Invariant
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#freeze-prohibitions" class="md-nav__link">
    <span class="md-ellipsis">
      
        FREEZE Prohibitions
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exclusive_access-lifecycle" class="md-nav__link">
    <span class="md-ellipsis">
      
        EXCLUSIVE_ACCESS Lifecycle
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#busy-reasons" class="md-nav__link">
    <span class="md-ellipsis">
      
        BUSY Reasons
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#retry-and-backpressure-guidance" class="md-nav__link">
    <span class="md-ellipsis">
      
        Retry and Backpressure Guidance
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#automatic-maintenance-triggers" class="md-nav__link">
    <span class="md-ellipsis">
      
        Automatic Maintenance Triggers
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memory-visibility" class="md-nav__link">
    <span class="md-ellipsis">
      
        Memory Visibility
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#freshness-vs-consistency" class="md-nav__link">
    <span class="md-ellipsis">
      
        Freshness vs Consistency
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#serialized-state-transitions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Serialized State Transitions
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#implementation-details" class="md-nav__link">
    <span class="md-ellipsis">
      
        Implementation Details
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Implementation Details">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#thread-safety-mechanisms" class="md-nav__link">
    <span class="md-ellipsis">
      
        Thread Safety Mechanisms
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maintenance-execution" class="md-nav__link">
    <span class="md-ellipsis">
      
        Maintenance Execution
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#versioning-and-iterator-invalidation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Versioning and Iterator Invalidation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#close-workflow" class="md-nav__link">
    <span class="md-ellipsis">
      
        Close Workflow
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#components" class="md-nav__link">
    <span class="md-ellipsis">
      
        Components
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#responsibilities" class="md-nav__link">
    <span class="md-ellipsis">
      
        Responsibilities
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#implementation-mapping" class="md-nav__link">
    <span class="md-ellipsis">
      
        Implementation Mapping
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#future-mvcc" class="md-nav__link">
    <span class="md-ellipsis">
      
        Future: MVCC
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_5" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../registry/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Registry
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_5" id="__nav_5_5_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Registry
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../registry/registry/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Segment Registry
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Community
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Community
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../CHANGELOG/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Changelog
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../development/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Development
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_6_2" id="__nav_6_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Development
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../development/documentation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Documentation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../development/guides/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Guides
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../development/segment-api/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Segment API
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../development/profiler-stacktrace/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    JVM Profiling
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../refactor-backlog/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Refactor Backlog
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../development/release/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Release Process
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../CONTRIBUTING/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Contributing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../CODE_OF_CONDUCT/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Code of Conduct
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#glossary" class="md-nav__link">
    <span class="md-ellipsis">
      
        Glossary
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#segment-operations" class="md-nav__link">
    <span class="md-ellipsis">
      
        Segment operations
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Segment operations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#response-codes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Response Codes
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#iterator-modes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Iterator Modes
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#segment-states" class="md-nav__link">
    <span class="md-ellipsis">
      
        Segment States
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Segment States">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#transitions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Transitions
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#optimistic-locking" class="md-nav__link">
    <span class="md-ellipsis">
      
        Optimistic locking
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Optimistic locking">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#iterator-isolation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Iterator Isolation
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#segment-behavior" class="md-nav__link">
    <span class="md-ellipsis">
      
        Segment Behavior
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Segment Behavior">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#operation-behavior-matrix" class="md-nav__link">
    <span class="md-ellipsis">
      
        Operation Behavior Matrix
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flushcompact-lifecycle" class="md-nav__link">
    <span class="md-ellipsis">
      
        Flush/Compact Lifecycle
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#failure-cancellation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Failure &amp; Cancellation
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#concepts" class="md-nav__link">
    <span class="md-ellipsis">
      
        Concepts
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Concepts">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#core-rules" class="md-nav__link">
    <span class="md-ellipsis">
      
        Core Rules
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#contracts-and-guarantees" class="md-nav__link">
    <span class="md-ellipsis">
      
        Contracts and Guarantees
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Contracts and Guarantees">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#atomic-publish-invariant" class="md-nav__link">
    <span class="md-ellipsis">
      
        Atomic Publish Invariant
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#freeze-prohibitions" class="md-nav__link">
    <span class="md-ellipsis">
      
        FREEZE Prohibitions
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exclusive_access-lifecycle" class="md-nav__link">
    <span class="md-ellipsis">
      
        EXCLUSIVE_ACCESS Lifecycle
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#busy-reasons" class="md-nav__link">
    <span class="md-ellipsis">
      
        BUSY Reasons
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#retry-and-backpressure-guidance" class="md-nav__link">
    <span class="md-ellipsis">
      
        Retry and Backpressure Guidance
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#automatic-maintenance-triggers" class="md-nav__link">
    <span class="md-ellipsis">
      
        Automatic Maintenance Triggers
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memory-visibility" class="md-nav__link">
    <span class="md-ellipsis">
      
        Memory Visibility
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#freshness-vs-consistency" class="md-nav__link">
    <span class="md-ellipsis">
      
        Freshness vs Consistency
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#serialized-state-transitions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Serialized State Transitions
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#implementation-details" class="md-nav__link">
    <span class="md-ellipsis">
      
        Implementation Details
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Implementation Details">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#thread-safety-mechanisms" class="md-nav__link">
    <span class="md-ellipsis">
      
        Thread Safety Mechanisms
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maintenance-execution" class="md-nav__link">
    <span class="md-ellipsis">
      
        Maintenance Execution
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#versioning-and-iterator-invalidation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Versioning and Iterator Invalidation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#close-workflow" class="md-nav__link">
    <span class="md-ellipsis">
      
        Close Workflow
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#components" class="md-nav__link">
    <span class="md-ellipsis">
      
        Components
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#responsibilities" class="md-nav__link">
    <span class="md-ellipsis">
      
        Responsibilities
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#implementation-mapping" class="md-nav__link">
    <span class="md-ellipsis">
      
        Implementation Mapping
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#future-mvcc" class="md-nav__link">
    <span class="md-ellipsis">
      
        Future: MVCC
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
                



  


  <nav class="md-path" aria-label="Navigation" >
    <ol class="md-path__list">
      
        
  
  
    <li class="md-path__item">
      <a href="../../.." class="md-path__link">
        
  <span class="md-ellipsis">
    Home
  </span>

      </a>
    </li>
  

      
      
        
  
  
    
    
      <li class="md-path__item">
        <a href="../../" class="md-path__link">
          
  <span class="md-ellipsis">
    Architecture
  </span>

        </a>
      </li>
    
  

      
        
  
  
    
    
      <li class="md-path__item">
        <a href="../" class="md-path__link">
          
  <span class="md-ellipsis">
    Segment
  </span>

        </a>
      </li>
    
  

      
    </ol>
  </nav>

              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="concurrency-lifecycle">Concurrency &amp; Lifecycle</h1>
<h2 id="glossary">Glossary</h2>
<ul>
<li>Published view: immutable view of the main index, delta cache, bloom filter, and sparse index.</li>
<li>Write cache: mutable map of recent writes not yet published.</li>
<li>Segment version: monotonic epoch counter used by optimistic iterators.</li>
<li>Maintenance thread: dedicated background thread for disk IO.</li>
</ul>
<h2 id="segment-operations">Segment operations</h2>
<p>Please look at main operations supported by segment. Other operations are from thread-safety not interesting.</p>
<table>
<thead>
<tr>
<th>Operation</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Segment.builder(directory)</code></td>
<td>Create a builder for constructing a segment with the provided directory.</td>
</tr>
<tr>
<td><code>compact()</code></td>
<td>Start compaction; returns once accepted.</td>
</tr>
<tr>
<td><code>openIterator(isolation)</code></td>
<td>Open an iterator with the requested isolation level.</td>
</tr>
<tr>
<td><code>put(key, value)</code></td>
<td>Write into the in-memory write cache.</td>
</tr>
<tr>
<td><code>flush()</code></td>
<td>Flush write cache to delta cache; returns once accepted.</td>
</tr>
<tr>
<td><code>get(key)</code></td>
<td>Perform a point lookup.</td>
</tr>
<tr>
<td><code>getState()</code></td>
<td>Return the current segment   state.</td>
</tr>
<tr>
<td><code>close()</code></td>
<td>Start async close; transitions to <code>CLOSED</code> when finished.</td>
</tr>
</tbody>
</table>
<ul>
<li><code>flush()</code> and <code>compact()</code> return <code>SegmentResult&lt;Void&gt;</code>; completion is observed by <code>getState()</code> returning <code>READY</code>.</li>
<li><code>close()</code> returns <code>SegmentResult&lt;Void&gt;</code> only; completion is observed via <code>getState()</code>.</li>
<li>Do not wait for <code>READY</code> while running on the segment maintenance
  executor thread; this can deadlock the maintenance queue.</li>
</ul>
<h3 id="response-codes">Response Codes</h3>
<p>All method depending on segment state could replay with on of the follown codes: </p>
<table>
<thead>
<tr>
<th>Code</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>OK</code></td>
<td>Processed successfully or operation was accepted and scheduled; completion is observed when the segment returns to <code>READY</code>.</td>
</tr>
<tr>
<td><code>BUSY</code></td>
<td>Temporary refusal; retry makes sense.</td>
</tr>
<tr>
<td><code>CLOSED</code></td>
<td>Segment permanently unavailable.</td>
</tr>
<tr>
<td><code>ERROR</code></td>
<td>Unrecoverable.</td>
</tr>
</tbody>
</table>
<ul>
<li><code>BUSY</code>/<code>CLOSED</code>/<code>ERROR</code> mean the operation was not started.</li>
</ul>
<h3 id="iterator-modes">Iterator Modes</h3>
<p>Segmend can open iterator in following modes:</p>
<ul>
<li><code>INTERRUPT_FAST</code> (default): optimistic read; throws on version change. Reads
  a snapshot of the merged view captured at open time.</li>
<li><code>STOP_FAST</code>: optimistic read; stops on version change. Reads a snapshot of the
  merged view captured at open time.</li>
<li><code>EXCLUSIVE_ACCESS</code>: stop-the-world maintenance; blocks other operations and
  must be short. Reads a merged snapshot captured while the segment is frozen.</li>
</ul>
<h2 id="segment-states">Segment States</h2>
<p>Segment could be in one of following states. States:</p>
<ul>
<li><code>READY</code>: normal operation.</li>
<li><code>MAINTENANCE_RUNNING</code>: background <code>flush()</code> or <code>compact()</code> is executing.</li>
<li><code>FREEZE</code>: short exclusive phase for snapshot or swap.</li>
<li><code>CLOSED</code>: segment closed.</li>
<li><code>ERROR</code>: unrecoverable.</li>
</ul>
<p>If an operation is not allowed in the current state, return <code>BUSY</code> in <code>FREEZE</code> or <code>MAINTENANCE_RUNNING</code>, <code>CLOSED</code> in <code>CLOSED</code>, and <code>ERROR</code> in <code>ERROR</code>.</p>
<p><img alt="Segment state machine" src="../images/segment-state-machine.png" /></p>
<h3 id="transitions">Transitions</h3>
<table>
<thead>
<tr>
<th>Original State</th>
<th>New State</th>
<th>When</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>READY</code></td>
<td><code>FREEZE</code></td>
<td>start of <code>flush()</code>, <code>compact()</code>, <code>close</code> or <code>openIterator(EXCLUSIVE_ACCESS)</code></td>
</tr>
<tr>
<td><code>FREEZE</code></td>
<td><code>MAINTENANCE_RUNNING</code></td>
<td>maintenance thread starts <code>flush()</code> or <code>compact()</code></td>
</tr>
<tr>
<td><code>MAINTENANCE_RUNNING</code></td>
<td><code>FREEZE</code></td>
<td>maintenance IO finished, swap to new files starts</td>
</tr>
<tr>
<td><code>FREEZE</code></td>
<td><code>READY</code></td>
<td>swap complete or <code>openIterator(EXCLUSIVE_ACCESS)</code> closed</td>
</tr>
<tr>
<td>any</td>
<td><code>ERROR</code></td>
<td>index or IO failure</td>
</tr>
<tr>
<td><code>FREEZE</code></td>
<td><code>CLOSED</code></td>
<td><code>close()</code> completes</td>
</tr>
</tbody>
</table>
<h2 id="optimistic-locking">Optimistic locking</h2>
<p>Core concept is that all data read via an iterator are immutable to the reader. When
<code>flush()</code> is called, iterators must stop to avoid serving a stale snapshot. This is
done via optimistic locking: when a segment iterator is opened it reads the segment
version, and before each read it verifies the version has not changed. If the version
changes, the iterator is interrupted. The version increments when a new immutable
view is published (after <code>flush()</code> or <code>compact()</code> swaps in new files) and when
<code>EXCLUSIVE_ACCESS</code> is acquired.</p>
<h3 id="iterator-isolation">Iterator Isolation</h3>
<p>optimistic locking allows distinguis following iteration modes:</p>
<ul>
<li>FAIL_FAST: optimistic read; any mutation can invalidate the iterator and
  terminate iteration early.</li>
<li>FULL_ISOLATION: exclusive access for the iterator lifetime; blocks writes,
  flush/compact, and split on the same segment until closed.</li>
</ul>
<h2 id="segment-behavior">Segment Behavior</h2>
<p>Segment can be accessd from multiple threads in paraell. Segment </p>
<h3 id="operation-behavior-matrix">Operation Behavior Matrix</h3>
<table>
<thead>
<tr>
<th>Operation</th>
<th>Allowed states</th>
<th>Version bump</th>
<th>Iterator impact</th>
<th>Read write cache</th>
<th>Read delta cache</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>put</code></td>
<td><code>READY</code>; <code>MAINTENANCE_RUNNING</code> (until cache full)</td>
<td>No</td>
<td>None</td>
<td>N/A</td>
<td>N/A</td>
<td>Writes to write cache; in <code>MAINTENANCE_RUNNING</code>, returns <code>BUSY</code> if cache full.</td>
</tr>
<tr>
<td><code>get</code></td>
<td><code>READY</code>, <code>MAINTENANCE_RUNNING</code></td>
<td>No</td>
<td>None</td>
<td>Yes</td>
<td>Yes</td>
<td>No read lock required.</td>
</tr>
<tr>
<td><code>flush</code></td>
<td><code>READY</code></td>
<td>Yes (after publish)</td>
<td>Invalidates optimistic iterators</td>
<td>N/A</td>
<td>N/A</td>
<td>Serialized; concurrent request returns <code>BUSY</code>. May be triggered by full write cache.</td>
</tr>
<tr>
<td><code>compact</code></td>
<td><code>READY</code></td>
<td>Yes (after publish)</td>
<td>Invalidates optimistic iterators</td>
<td>N/A</td>
<td>N/A</td>
<td>Serialized; concurrent request returns <code>BUSY</code>. May be triggered by full delta cache.</td>
</tr>
<tr>
<td><code>openIterator(INTERRUPT_FAST)</code></td>
<td><code>READY</code></td>
<td>No</td>
<td>Throws on version change</td>
<td>Yes (snapshot)</td>
<td>Yes</td>
<td>Default mode.</td>
</tr>
<tr>
<td><code>openIterator(STOP_FAST)</code></td>
<td><code>READY</code></td>
<td>No</td>
<td>Stops on version change</td>
<td>Yes (snapshot)</td>
<td>Yes</td>
<td>Snapshot captured at open time.</td>
</tr>
<tr>
<td><code>openIterator(EXCLUSIVE_ACCESS)</code></td>
<td><code>READY</code></td>
<td>Yes (on lock acquisition)</td>
<td>Invalidates existing iterators; blocks others</td>
<td>Yes</td>
<td>Yes</td>
<td>Maintenance only; must be short.</td>
</tr>
<tr>
<td><code>close</code></td>
<td><code>READY</code></td>
<td>No</td>
<td>Invalidates existing iterators; blocks others</td>
<td>N/A</td>
<td>N/A</td>
<td>Sets <code>FREEZE</code>, optionally flushes the write cache, schedules close on maintenance thread, then transitions to <code>CLOSED</code>.</td>
</tr>
</tbody>
</table>
<h3 id="flushcompact-lifecycle">Flush/Compact Lifecycle</h3>
<ol>
<li>Caller enters <code>FREEZE</code>, drains in-flight ops, and prepares the maintenance
   plan (flush freezes the write cache; compact captures a snapshot).</li>
<li>Maintenance thread sets <code>MAINTENANCE_RUNNING</code> and performs IO.</li>
<li>When IO completes, state returns to <code>FREEZE</code> and new index/delta files are swapped in.</li>
<li>Version increments immediately after the swap (publication).</li>
<li>State becomes <code>READY</code>.</li>
<li>Concurrent <code>flush()</code>/<code>compact()</code> requests return <code>BUSY</code>.</li>
</ol>
<h3 id="failure-cancellation">Failure &amp; Cancellation</h3>
<ul>
<li>On <code>flush()</code> or <code>compact()</code> failure, the current maintenance task aborts and
  the segment moves to <code>ERROR</code> (unless already <code>CLOSED</code>).</li>
<li>If <code>close()</code> is called during maintenance, the segment returns <code>BUSY</code>.
  Retry after the segment returns to <code>READY</code>.</li>
</ul>
<hr />
<hr />
<h2 id="concepts">Concepts</h2>
<h3 id="core-rules">Core Rules</h3>
<ul>
<li>Concurrent reads/writes are supported; published data is immutable to readers.</li>
<li>No disk IO in caller threads; the maintenance thread performs disk IO.</li>
<li>Keep locks short; the state machine is the admission control.</li>
<li><code>flush()</code> and <code>compact()</code> are commit points and are started asynchronously.</li>
<li><code>Segment</code> is thread-safe by contract; callers may access it concurrently.</li>
<li><code>FREEZE</code> is a short exclusive phase used for snapshotting, publish swaps, or
  close admission.</li>
</ul>
<h3 id="contracts-and-guarantees">Contracts and Guarantees</h3>
<h4 id="atomic-publish-invariant">Atomic Publish Invariant</h4>
<ul>
<li>Publication of a new immutable view is atomic: readers see either the old view or the new view, never a partial mix.</li>
<li>The view swap and version increment are linearized; operations after the swap observe the new view.</li>
</ul>
<h4 id="freeze-prohibitions">FREEZE Prohibitions</h4>
<ul>
<li>During <code>FREEZE</code>, all external operations return <code>BUSY</code>.</li>
<li>Only internal maintenance steps (snapshot and swap) run in this phase.</li>
</ul>
<h4 id="exclusive_access-lifecycle">EXCLUSIVE_ACCESS Lifecycle</h4>
<ul>
<li><code>openIterator(EXCLUSIVE_ACCESS)</code> is allowed only in <code>READY</code>; otherwise it returns <code>BUSY</code>.</li>
<li>On acquisition, the segment enters <code>FREEZE</code> and increments the version.</li>
<li>While held, all other operations return <code>BUSY</code>. The iterator must be closed to return to <code>READY</code>.</li>
</ul>
<h4 id="busy-reasons">BUSY Reasons</h4>
<ul>
<li>Write cache full during <code>MAINTENANCE_RUNNING</code> (backpressure).</li>
<li>Segment is in <code>FREEZE</code>.</li>
<li><code>MAINTENANCE_RUNNING</code> and the requested operation is not allowed.</li>
<li><code>flush()</code> / <code>compact()</code> already running.</li>
<li><code>EXCLUSIVE_ACCESS</code> held or requested while not <code>READY</code>.</li>
</ul>
<h4 id="retry-and-backpressure-guidance">Retry and Backpressure Guidance</h4>
<ul>
<li>Treat <code>BUSY</code> as transient; retry with backoff and jitter.</li>
<li>For write-cache full during <code>MAINTENANCE_RUNNING</code>, retry writes after maintenance publishes a new view.</li>
<li>For maintenance or exclusive access, retry after the segment returns to <code>READY</code>.</li>
</ul>
<h4 id="automatic-maintenance-triggers">Automatic Maintenance Triggers</h4>
<ul>
<li>If the delta cache becomes full, the segment schedules <code>compact()</code>.</li>
<li>If the write cache becomes full, the segment schedules <code>flush()</code>.</li>
<li>These triggers transition the segment out of <code>READY</code> (into <code>FREEZE</code>/<code>MAINTENANCE_RUNNING</code>) before refusing new writes.</li>
</ul>
<h4 id="memory-visibility">Memory Visibility</h4>
<ul>
<li>The published view is swapped under <code>FREEZE</code> (exclusive); new reads see only the old or the new view, never a partial publish.</li>
<li>Version increments provide an ordering point for optimistic iterators.</li>
</ul>
<h4 id="freshness-vs-consistency">Freshness vs Consistency</h4>
<ul>
<li><code>get</code> reads from the write cache and published view (freshest data).</li>
<li>Iterators read a snapshot of the merged view (published + write cache) taken
  at open time; later <code>put()</code> calls are not visible. Iterators are invalidated
  only by version changes (publish or <code>EXCLUSIVE_ACCESS</code>).</li>
</ul>
<h4 id="serialized-state-transitions">Serialized State Transitions</h4>
<ul>
<li>State transitions are serialized; only one transition is in flight at a time.</li>
<li><code>flush()</code>, <code>compact()</code>, and <code>EXCLUSIVE_ACCESS</code> are mutually exclusive and linearized.</li>
</ul>
<h2 id="implementation-details">Implementation Details</h2>
<h3 id="thread-safety-mechanisms">Thread Safety Mechanisms</h3>
<ul>
<li>Segment version is stored in <code>VersionController</code> (an <code>AtomicInteger</code>).</li>
<li>The write cache uses a thread-safe map implementation.</li>
<li><code>SegmentConcurrencyGate</code> tracks in-flight reads/writes and drains them during <code>FREEZE</code>.</li>
</ul>
<h3 id="maintenance-execution">Maintenance Execution</h3>
<ul>
<li><code>SegmentMaintenanceService.startMaintenance(...)</code> enters <code>FREEZE</code>, drains in-flight ops, builds work, then transitions to <code>MAINTENANCE_RUNNING</code> and schedules the maintenance task.</li>
<li><code>runMaintenance(...)</code> executes IO work, returns to <code>FREEZE</code>, runs publish work, then returns to <code>READY</code> and optionally runs the <code>onReady</code> callback.</li>
<li>Failures call <code>gate.fail()</code> unless the segment is already <code>CLOSED</code>.</li>
</ul>
<h3 id="versioning-and-iterator-invalidation">Versioning and Iterator Invalidation</h3>
<ul>
<li><code>SegmentWritePath.applyFrozenWriteCacheAfterFlush()</code> merges frozen entries and bumps the version when a snapshot was applied.</li>
<li><code>SegmentCompacter.publishCompaction(...)</code> bumps the version after publish.</li>
<li><code>SegmentCore.invalidateIterators()</code> bumps the version for explicit invalidation or exclusive access.</li>
</ul>
<h3 id="close-workflow">Close Workflow</h3>
<ul>
<li><code>SegmentImpl.close()</code> enters <code>FREEZE</code>, drains in-flight ops, freezes the write cache, and schedules <code>runClose(...)</code> on the maintenance executor.</li>
<li><code>runClose(...)</code> flushes frozen data (if any), closes the core, transitions to <code>CLOSED</code>, and releases the segment lock.</li>
</ul>
<h3 id="components">Components</h3>
<ul>
<li><strong>Segment</strong>: user-facing API (<code>put</code>, <code>get</code>, <code>openIterator</code>, <code>flush</code>,
  <code>compact</code>) implemented by <code>SegmentImpl</code>.</li>
<li><strong>SegmentImpl</strong>: owns <code>SegmentStateMachine</code>, checks state, and delegates
  to <code>SegmentCore</code>. Schedules maintenance work on the provided executor.</li>
<li><strong>SegmentCore</strong>: single-threaded core with caches, on-disk access, and
  version tracking.</li>
<li><strong>SegmentStateMachine</strong>: atomic lifecycle transitions (<code>READY</code> 
  <code>FREEZE</code>  <code>MAINTENANCE_RUNNING</code>  <code>READY</code>).</li>
<li><strong>SegmentCompacter</strong>: performs full rewrite compaction using
  <code>SegmentCore</code>.</li>
<li><strong>SegmentMaintenanceCoordinator</strong> (segmentindex): decides when to call
  <code>flush()</code>/<code>compact()</code> after writes.</li>
<li><strong>SegmentAsyncExecutor</strong> + executor (segmentindex): maintenance executor
  provided to <code>SegmentImpl</code> via <code>SegmentRegistry</code>.</li>
<li><strong>SegmentAsyncSplitCoordinator / SegmentSplitCoordinator</strong> (segmentindex):
  schedule and perform segment splits.</li>
</ul>
<h3 id="responsibilities">Responsibilities</h3>
<ul>
<li><strong>SegmentImpl</strong>: gates operations with the state machine, schedules
  maintenance on the executor, and reports status via <code>SegmentResult</code>.</li>
<li><strong>SegmentCore</strong>: executes single-threaded read/write/maintenance steps,
  manages caches and version updates, and performs no threading or state
  transitions.</li>
</ul>
<h3 id="implementation-mapping">Implementation Mapping</h3>
<ul>
<li><code>EXCLUSIVE_ACCESS</code> in this document maps to
  <code>SegmentIteratorIsolation.FULL_ISOLATION</code> in code.</li>
<li><code>INTERRUPT_FAST</code> / <code>STOP_FAST</code> map to
  <code>SegmentIteratorIsolation.FAIL_FAST</code>.</li>
<li>State transitions are enforced by <code>SegmentStateMachine</code> and executed in
  <code>SegmentMaintenanceService.startMaintenance(...)</code> and
  <code>SegmentMaintenanceService.runMaintenance(...)</code>.</li>
<li>Maintenance scheduling lives in <code>SegmentMaintenanceCoordinator</code> and uses the
  executor from <code>SegmentRegistry</code> (<code>SegmentAsyncExecutor</code>).</li>
</ul>
<h2 id="future-mvcc">Future: MVCC</h2>
<p>Currently unused. MVCC could support iterators that remain consistent across version changes, balancing deadlocks, performance, and memory.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../../..", "features": ["navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "navigation.expand", "navigation.path", "navigation.indexes", "toc.follow", "search.highlight", "search.share", "search.suggest"], "search": "../../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
    
  </body>
</html>